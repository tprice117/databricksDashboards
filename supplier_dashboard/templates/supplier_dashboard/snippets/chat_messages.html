{% load static %}
{% for message in chat %}
    {% if message.is_admin %}
        <div class="row align-items-center no-gutters" style="margin-top: 24px;">
            <div class="col-8 mx-auto">
                <div class="card" style="background: var(--bs-warning-border-subtle);color: var(--bs-primary-text-emphasis);">
                    <div class="card-body">
                        <p class="card-text">{{ message.body|safe }}</p>
                    </div>
                </div>
                <div class="row float-end">
                    <div class="col">
                        <small class="form-text">{{ message.created_at|timesince }} ago&nbsp;&nbsp;</small>
                        <small class="form-text">{{ message.author }}&nbsp;&nbsp;</small>
                        {% if message.photo %}
                            <img class="rounded-circle" width="100" height="80" style="width: 20px;height: 20px;" src="{{ message.photo.url }}" />
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    {% elif message.sent_by_current_user %}
        <div class="row align-items-center no-gutters" style="margin-top: 24px;">
            <div class="col-8 ms-auto me-2">
                <div class="card" style="background: var(--bs-secondary-border-subtle);color: var(--bs-primary-text-emphasis);">
                    <div class="card-body">
                        <p class="card-text">{{ message.body|safe }}</p>
                    </div>
                </div>
                <div class="row float-end">
                    <div class="col">
                        <small class="form-text">{{ message.created_at|timesince }} ago&nbsp;&nbsp;</small>
                        <small class="form-text">Me&nbsp;&nbsp;</small>
                        {% if message.photo %}
                            <img class="rounded-circle" width="100" height="80" style="width: 20px;height: 20px;" src="{{ message.photo.url }}" />
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    {% else %}
        <div class="row align-items-center no-gutters" style="margin-top: 24px;">
            <div class="col-8 me-2">
                <div class="card" style="background: var(--bs-primary-bg-subtle);color: var(--bs-primary-text-emphasis);">
                    <div class="card-body">
                        <p class="card-text">{{ message.body|safe }}</p>
                    </div>
                </div>
                <div class="row float-end">
                    <div class="col">
                        <small class="form-text">{{ message.created_at|timesince }} ago&nbsp;&nbsp;</small>
                        <small class="form-text">{{ message.author }}&nbsp;&nbsp;</small>
                        {% if message.photo %}
                            <img class="rounded-circle" width="100" height="80" style="width: 20px;height: 20px;" src="{{ message.photo.url }}" />
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
{% endfor %}
<span class="d-none" id="htmx-chat-get" hx-get="{% url 'supplier_chat' order_id=order.id %}?last={{ last_message_time|urlencode }}" hx-trigger="every 5s" hx-swap="innerHTML" hx-target="#booking-chat" hx-swap-oob="true"></span>
{% if message_form %}
    <form id="booking-chat-form" action="{% url 'supplier_chat' order_id=order.id %}" method="post" hx-boost="true" hx-target="#booking-chat" hx-swap="innerHTML" enctype="multipart/form-data" hx-disabled-elt="button" hx-swap-oob="true">
        {% csrf_token %}
        <div class="row" style="margin-top: 16px;padding-top: 16px;border-top-style: solid;border-top-color: var(--bs-primary);">
            <div class="col d-md-flex justify-content-md-start">
                {{ message_form }}
                <button class="btn btn-primary" type="submit">
                    Send
                    <span class="htmx-indicator" id="htmx-indicator-loading"><img class="svg-loader" src="{% static 'supplier_dashboard/svg-loaders/bars.svg' %}" /></span>
                </button>
            </div>
        </div>
    </form>
{% endif %}
