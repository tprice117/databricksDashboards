{% load static %}
{% for message in chat %}
    {% if message.is_admin %}
        <div class="row align-items-center no-gutters" style="margin-top: 24px;">
            <div class="col-8 mx-auto">
                <div class="card" style="background: var(--bs-warning-border-subtle);color: var(--bs-primary-text-emphasis);">
                    <div class="card-body">
                        <p class="card-text">{{ message.body|safe }}</p>
                    </div>
                </div>
                <div class="row float-end">
                    <div class="col">
                        <small class="form-text">{{ message.created_at|timesince }} ago&nbsp;&nbsp;</small>
                        <small class="form-text">Downstream&nbsp;&nbsp;</small>
                        {% if message.photo %}
                            <img class="rounded-circle" width="100" height="80" style="width: 20px;height: 20px;" src="{{ message.photo.url }}" />
                        {% else %}
                            <img class="rounded-circle" width="100" height="80" style="width: 20px;height: 20px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAABbElEQVR4AWNhLC9lYGBkYPjPAAIEGYwsDH/+MpACgBr+YBP/DzYSq4bff5AtZWdmkhIQYmRk+PXnz/MPH/9CpVBs+A3naElIlri7X3z06N///1xs7KoS4uvOnd1+5fJ/JNuANiA0pNrYZC1YoCohAbTk1aeP3Vs3l3p6ff/2ff/NGyhO+s/wnxFsBiPQ5F8/Wf7+Yf73x0xONsLUpGrFiq6oqP1gS8DB9J/l/+9fjDBvzt2zuz8m9urjJ//+/1uwf3+Bp6cUL+/n79+Zf/3+ywj1JQvjL6iTgJwrd+/lzpghzs8PZP/4+k0UqPrzZxagWUjOhvsBFI4Jrq76ioqQcOFkYd1/+dK/Xz+Z//37BwyY/9CARgml+du3AT0Ddi7QtQwSQoITUtLqFy1ADhigHxARF+XkpC2vAPY+CHz+9rV8xvTXHz8ixwULI5INy3fuhDFhfgRHHHKco9hADADaQIKG/yAb/vzGTMp4AACCn6yMFV/i0QAAAABJRU5ErkJggg==" />
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    {% elif message.sent_by_current_user %}
        <div class="row align-items-center no-gutters" style="margin-top: 24px;">
            <div class="col-8 ms-auto me-2">
                <div class="card" style="background: var(--bs-secondary-border-subtle);color: var(--bs-primary-text-emphasis);">
                    <div class="card-body">
                        <p class="card-text">{{ message.body|safe }}</p>
                    </div>
                </div>
                <div class="row float-end">
                    <div class="col">
                        <small class="form-text">{{ message.created_at|timesince }} ago&nbsp;&nbsp;</small>
                        <small class="form-text">Me&nbsp;&nbsp;</small>
                        {% if message.photo %}
                            <img class="rounded-circle" width="100" height="80" style="width: 20px;height: 20px;" src="{{ message.photo.url }}" />
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    {% else %}
        <div class="row align-items-center no-gutters" style="margin-top: 24px;">
            <div class="col-8 me-2">
                <div class="card" style="background: var(--bs-primary-bg-subtle);color: var(--bs-primary-text-emphasis);">
                    <div class="card-body">
                        <p class="card-text">{{ message.body|safe }}</p>
                    </div>
                </div>
                <div class="row float-end">
                    <div class="col">
                        <small class="form-text">{{ message.created_at|timesince }} ago&nbsp;&nbsp;</small>
                        <small class="form-text">{{ message.author }}&nbsp;&nbsp;</small>
                        {% if message.photo %}
                            <img class="rounded-circle" width="100" height="80" style="width: 20px;height: 20px;" src="{{ message.photo.url }}" />
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
{% endfor %}
{% if message_form %}
    <form id="booking-chat-form" action="{% url 'supplier_chat' order_id=order.id %}" method="post" hx-boost="true" hx-target="#booking-chat" hx-swap="innerHTML" enctype="multipart/form-data" hx-disabled-elt="button" hx-swap-oob="true">
        {% csrf_token %}
        <div class="row" style="margin-top: 16px;padding-top: 16px;border-top-style: solid;border-top-color: var(--bs-primary);">
            <div class="col d-md-flex justify-content-md-start">
                {{ message_form }}
                <button class="btn btn-primary" type="submit">
                    Send
                    <span class="htmx-indicator" id="htmx-indicator-loading"><img class="svg-loader" src="{% static 'supplier_dashboard/svg-loaders/bars.svg' %}" /></span>
                </button>
            </div>
        </div>
    </form>
{% endif %}
