{% extends 'dashboards/base.html' %}
{% load static %}
{% load humanize %}
{% block title %}
timetoacceptance
{% endblock %}
{% block content %}
<style>
    table tbody tr:nth-child(odd) {
        background-color: #505063;
    }
    table tbody tr:nth-child(even) {
        background-color: #80808c;
    }
    ul #nav2  {
        list-style-type: none;
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: #333;
      }
    li #nav2 {
        float: left;
    }
    li.active a {
        background-color: #4CAF50;
        color: white;
    }
    thead th {
        position: sticky;
        top: 0;
        background-color: #333;
        color: white;
        z-index: 1;
    }
</style>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Sales Detail</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/2.1.8/css/dataTables.dataTables.css">
    <script defer src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script defer src="https://cdn.datatables.net/2.1.8/js/dataTables.js"></script>
</head>
<body>
    <nav>
    </nav>
    <header>

    </header>
    <main style="text-align: center; margin-top: 20px;">
        <button id="toggleSectionBtn" style="background-color: #007BFF; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">Switch Section</button>
        <section id="section1">
            <h3>Time to Acceptance: {{orders_count}} Orders Tracked</h3>
            <div class="row">
                <div class="col-md-6 col-xl-3 mb-4">
                    <div class="card shadow border-left-primary py-2">
                        <div class="card-body">
                            <div class="row g-0 align-items-center">
                                <div class="col me-2">
                                    <div class="text-uppercase text-primary fw-bold text-xs mb-1"><span>Avg Time To Acceptance
                                    </span></div>
                                    <div class="text-light fw-bold h5 mb-0"><span>{{avg_time_to_accepted_hours|floatformat:2}}</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-xl-3 mb-4">
                    <div class="card shadow border-left-success py-2">
                        <div class="card-body">
                            <div class="row g-0 align-items-center">
                                <div class="col me-2">
                                    <div class="text-uppercase text-success fw-bold text-xs mb-1"><span>Avg Time To Completed
                                    </span></div>
                                    <div class="text-light fw-bold h5 mb-0"><span>{{avg_time_to_completed_hours|floatformat:2}}</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <canvas id="ordersChart" width="400" height="200" style="background-color: #4a4949;"></canvas>
            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <script>
                var ctx = document.getElementById('ordersChart').getContext('2d');
                var ordersChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: {{ orders_chart_labels|safe }},
                        datasets: [
                            {
                                label: 'Internal Orders',
                                data: {{ internal_orders_chart_data|safe }},
                                backgroundColor: 'rgba(54, 162, 235, 0.4)',
                                borderColor: 'rgba(54, 162, 235, 1)',
                                borderWidth: 1
                            },
                            {
                                label: 'External Orders',
                                data: {{ external_orders_chart_data|safe }},
                                backgroundColor: 'rgba(255, 99, 132, 0.4)',
                                borderColor: 'rgba(255, 99, 132, 1)',
                                borderWidth: 1
                            },
                            {
                                type: 'line',
                                label: 'Average Time to Acceptance',
                                data: {{ avg_time_to_accepted_chart_data|safe }},
                                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                borderColor: 'rgba(75, 192, 192, 1)',
                                borderWidth: 2,
                                fill: false
                            }
                        ] 
                    },
                    options: {
                        plugins: {
                            legend: {
                                labels: {
                                    color: 'white'
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    color: 'white'
                                }
                            },
                            x: {
                                ticks: {
                                    color: 'white'
                                }
                            }
                        }
                    }
                });
            </script>
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    new DataTable('#orders-table');
                });
            </script>
            <div style="overflow-x: auto; max-height: 60em;">
                <table id="orders-table" class="display">
                    <thead>
                        <tr style="border-bottom: 1px solid #ddd;">
                            <th style="padding-right: 200px;">id</th>
                            <th style="padding-right: 200px;">end_date</th>
                            <th style="padding-right: 200px;">accepted_on</th>
                            <th style="padding-right: 200px;">accepted_by</th>
                            <th style="padding-right: 200px;">completed_on</th>
                            <th style="padding-right: 200px;">completed_by</th>
                            <th style="padding-right: 200px;">submitted_on</th>
                            <th style="padding-right: 200px;">submitted_by</th>
                            <th style="padding-right: 200px;">time_accepted</th>
                            <th style="padding-right: 200px;">time_to_completed_hours</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for order in orders %}
                        <tr>
                            <td>{{ order.id }}</td>
                            <td>{{ order.end_date }}</td>
                            <td>{{ order.accepted_on }}</td>
                            <td>{{ order.accepted_by_username }}</td>
                            <td>{{ order.completed_on }}</td>
                            <td>{{ order.completed_by_username }}</td>
                            <td>{{ order.submitted_on }}</td>
                            <td>{{ order.submitted_by_username }}</td>
                            <td>{{ order.time_to_accepted_hours }}</td>
                            <td>{{ order.time_to_completed_hours }}</td>
                        </tr>
                        {% endfor %}                    
                    </tbody>
                </table>
            </div>
        </section>
        <section id="section2" style="display: none;">
            <h3>Time to Completion: {{orders_count}} Orders Tracked</h3>
            <div class="row">
                <div class="col-md-6 col-xl-3 mb-4">
                    <div class="card shadow border-left-primary py-2">
                        <div class="card-body">
                            <div class="row g-0 align-items-center">
                                <div class="col me-2">
                                    <div class="text-uppercase text-primary fw-bold text-xs mb-1"><span>Avg Time To Acceptance
                                    </span></div>
                                    <div class="text-light fw-bold h5 mb-0"><span>{{avg_time_to_accepted_hours|floatformat:2}}</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-xl-3 mb-4">
                    <div class="card shadow border-left-success py-2">
                        <div class="card-body">
                            <div class="row g-0 align-items-center">
                                <div class="col me-2">
                                    <div class="text-uppercase text-success fw-bold text-xs mb-1"><span>Avg Time To Completed
                                    </span></div>
                                    <div class="text-light fw-bold h5 mb-0"><span>{{avg_time_to_completed_hours|floatformat:2}}</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <canvas id="completedOrdersChart" width="400" height="200" style="background-color: #4a4949;"></canvas>
                <script>
                    var ctxCompleted = document.getElementById('completedOrdersChart').getContext('2d');
                    var completedOrdersChart = new Chart(ctxCompleted, {
                        type: 'bar',
                        data: {
                            labels: {{ completed_by_chart_labels|safe }},
                            datasets: [
                                {
                                    label: 'Completed Orders',
                                    data: {{ completed_by_chart_data|safe }},
                                    backgroundColor: 'rgba(153, 102, 255, 0.4)',
                                    borderColor: 'rgba(153, 102, 255, 1)',
                                    borderWidth: 1
                                },
                                {
                                    type: 'line',
                                    label: 'Average Time to Completion',
                                    data: {{ avg_time_to_completed_chart_data|safe }},
                                    backgroundColor: 'rgba(255, 206, 86, 0.2)',
                                    borderColor: 'rgba(255, 206, 86, 1)',
                                    borderWidth: 2,
                                    fill: false
                                }
                            ]
                        },
                        options: {
                            plugins: {
                                legend: {
                                    labels: {
                                        color: 'white'
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        color: 'white'
                                    }
                                },
                                x: {
                                    ticks: {
                                        color: 'white'
                                    }
                                }
                            }
                        }
                    });
                </script>
        </section>
        <script>
            document.getElementById('toggleSectionBtn').addEventListener('click', function() {
                var section1 = document.getElementById('section1');
                var section2 = document.getElementById('section2');
                if (section1.style.display === 'none') {
                    section1.style.display = 'block';
                    section2.style.display = 'none';
                } else {
                    section1.style.display = 'none';
                    section2.style.display = 'block';
                }
            });
        </script>
    </main>
    <footer>
        <p>&copy; 2024 | Downstream | Sales Data by Rep</p>
    </footer>
</body>
</html>

{% endblock %}