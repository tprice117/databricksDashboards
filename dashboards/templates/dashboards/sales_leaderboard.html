{% extends 'dashboards/base.html' %}
{% load static %}
{% load humanize %}
{% block title %}
Sales Leaderboard
{% endblock %}
{% block content %}
<!-- <style>
    .progress-bar{
        width: {{takeRate}}%;
    }
</style> -->
<div class="container-fluid">
    <h3 class="text-light mb-4">Sales Leaderboard ({% now "F" %})</h3>
    <div class="card shadow">
        <div class="card-body">
            <div class="table-responsive table mt-2" id="dataTable" role="grid" aria-describedby="dataTable_info">
                <table class="table my-0" id="dataTable">
                    <thead>
                        <tr>
                            <th>Sales Rep</th>
                            <th>GMV</th>
                            <th>Avg. Discount</th>
                            <th>Net</th>
                            <th>Order Count</th>
                            <th>New Companies</th>
                            <th>New Users</th>
                            <th>Score</th>
                        </tr>
                    </thead>
                    <tbody>
                      {% for user in users %}
                        <tr>
                            <td>
                              <img class="rounded-circle me-2" width="30" height="30" src="
                                {% if user.photo %}
                                  {{ user.photo.url }}
                                {% else %}
                                  {% static 'customer_dashboard/img/dogs/image2.jpeg' %}
                                {% endif %}"
                            ><a href="{% url 'user_sales_detail' user.id %}">{{user.first_name}} {{user.last_name}}</a>
                            </td>
                            <td>${{user.gmv|floatformat:2|intcomma}}</td>
                            <td>{{user.avg_discount|floatformat:2|intcomma}}%</td>
                            <td>${{user.net_revenue|floatformat:2|intcomma}}</td>
                            <td>{{user.order_count|intcomma}}</td>
                            <td>{{user.new_companies}}</td>
                            <td>{{user.new_users}}</td>
                        </tr>
                      {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="table-responsive table mt-4">
                <h4 class="text-light mb-4">Presidents Club Leaderboard - New Buyers (40% of score)</h4>
                <table class="table my-0">
                    <thead>
                        <tr>
                            <th>Sales Rep</th>
                            <th>UserCount</th>
                            <th>Points</th>
                            <th>Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in users|dictsortreversed:"new_buyers"  %}
                            <tr>
                                <td>
                                    <img class="rounded-circle me-2" width="30" height="30" src="
                                        {% if user.photo %}
                                            {{ user.photo.url }}
                                        {% else %}
                                            {% static 'customer_dashboard/img/dogs/image2.jpeg' %}
                                        {% endif %}">
                                    <a href="{% url 'user_sales_detail' user.id %}">{{user.first_name}} {{user.last_name}}</a>
                                </td>
                                <td>{{user.new_buyers}}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <div class="table-responsive table mt-4">
                <h4 class="text-light mb-4">Presidents Club Leaderboard - GMV (25% of score)</h4>
                <table class="table my-0">
                    <thead>
                        <tr>
                            <th>Sales Rep</th>
                            <th>Current GMV</th>
                            <th>Points</th>
                            <th>Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in users|dictsortreversed:"gmv"  %}
                            <tr>
                                <td>
                                    <img class="rounded-circle me-2" width="30" height="30" src="
                                        {% if user.photo %}
                                            {{ user.photo.url }}
                                        {% else %}
                                            {% static 'customer_dashboard/img/dogs/image2.jpeg' %}
                                        {% endif %}">
                                    <a href="{% url 'user_sales_detail' user.id %}">{{user.first_name}} {{user.last_name}}</a>
                                </td>
                                <td>${{user.gmv|floatformat:2|intcomma}}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="table-responsive table mt-4">
                <h4 class="text-light mb-4">Presidents Club Leaderboard - Platform Adoption (25% of score)</h4>
                <table class="table my-0">
                    <thead>
                        <tr>
                            <th>Sales Rep</th>
                            <th>Order Count</th>
                            <th>Points</th>
                            <th>Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in users|dictsortreversed:"external_orders_count" %}
                            <tr>
                                <td>
                                    <img class="rounded-circle me-2" width="30" height="30" src="
                                        {% if user.photo %}
                                            {{ user.photo.url }}
                                        {% else %}
                                            {% static 'customer_dashboard/img/dogs/image2.jpeg' %}
                                        {% endif %}">
                                    <a href="{% url 'user_sales_detail' user.id %}">{{user.first_name}} {{user.last_name}}</a>
                                </td>
                                <td>{{user.external_orders_count}}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="table-responsive table mt-4">
                <h4 class="text-light mb-4">Presidents Club Leaderboard - Discount Rate (10% of score)</h4>
                <table class="table my-0">
                    <thead>
                        <tr>
                            <th>Discount Rate</th>
                            <th>Points</th>
                            <th>Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in users|dictsortreversed:"external_orders_count" %}
                            <tr>
                                <td>
                                    <img class="rounded-circle me-2" width="30" height="30" src="
                                        {% if user.photo %}
                                            {{ user.photo.url }}
                                        {% else %}
                                            {% static 'customer_dashboard/img/dogs/image2.jpeg' %}
                                        {% endif %}">
                                    <a href="{% url 'user_sales_detail' user.id %}">{{user.first_name}} {{user.last_name}}</a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}