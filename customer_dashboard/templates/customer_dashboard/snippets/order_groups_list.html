{% load static %}
<div id="order-groups-results">
  {% for booking_group in bookings %}
    {% with address=booking_group.user_address %}
      <div class="card shadow-sm mb-3">
        <div class="card-header p-4 rounded-3 bg-secondary text-white {% if not forloop.first %}collapsed {% endif %}" type="button" data-bs-toggle="collapse" data-bs-target="#item-{{ forloop.counter }}" aria-expanded="{{ forloop.first|lower }}" aria-controls="item-{{ forloop.counter }}">
          <h6 class="mb-0 d-flex align-items-center text-nowrap" style="width: 95%;">
            <span class="text-truncate">
              {% if address.name %}
                {{ address.name }} |
              {% endif %}{{ address.formatted_address }}
            </span>
            <span id="count-{{ address.id }}" class="badge text-bg-primary ms-2 me-2" data-count="{{ booking_group.count }}">{{ booking_group.count }} item{{ booking_group.count|pluralize }}</span>
            {% if request.user.is_staff %}
              <span class="badge text-primary bg-white">
                {% if address.user_group.name %}
                  {{ address.user_group.name }}
                {% elif address.user.user_group.name %}
                  {{ address.user.user_group.name }}
                {% endif %}
              </span>
              <span class="col"></span>
              <span class="ms-2 badge text-primary bg-white">{{ address.user.user_group.account_owner.full_name }}</span>
            {% endif %}
          </h6>
        </div>
        <!-- prettier-ignore -->
        <div id="item-{{ forloop.counter }}" class="collapse {% if forloop.first %}show {% endif %}">
        <div class="card-body row">
            {% for item in booking_group.nr %}
              <div class="col-xl-4 col-md-6 col-12 mb-2">
                  {% include 'customer_dashboard/snippets/order_group_card.html' with loopcount=forloop.counter type="not_related" %}
              </div>
            {% endfor %}
            <div class="w-100"></div>
            {% for chain in booking_group.r0.values %}
              <div class="col-xl-4 col-md-6 col-12 mb-2">
                {% include 'customer_dashboard/snippets/order_group_card.html' with item=chain.order_group loopcount=forloop.counter type="parent" %}
                {% for related in chain.related %}
                  {% include 'customer_dashboard/snippets/order_group_card.html' with item=related loopcount=forloop.counter type="related" %}
                {% endfor %}
              </div>
            {% endfor %}
        </div>
      </div>
      </div>
    {% endwith %}
  {% empty %}
    <div class="text-center">
      <h5 class="text-muted">No results.</h5>
    </div>
  {% endfor %}
</div>
<div id="order-groups-pagination" hx-swap-oob="true">
  {% include 'customer_dashboard/snippets/pagination.html' with target_id='#order-groups-results' %}
</div>
