{% load static %}
{% load tz %}
{% load humanize %}
{% load sales_stream_tags %}
{% with order_group=item %}
  <!-- prettier-ignore -->
  <div class="card lead-card {% if order_group.parent_booking or order_group.related_bookings.exists %}border-primary rounded{% else %}border-0{% endif %}" style="background-color: var(--bs-card-cap-bg);" onmouseover="this.style.backgroundColor='#f0f0f0';" onmouseout="this.style.backgroundColor='var(--bs-card-cap-bg)';">
    <!-- Card Overlay -->
    <a href="{% url 'customer_order_group_detail' order_group_id=order_group.id %}" class="text-decoration-none text-reset overlay" data-bs-toggle="tooltip" data-bs-placement="top"></a>
    <!-- Card Content -->
    <div class="inner">
      <div class="card-body">
        <div class="col">
            {% with main_product=order_group.seller_product_seller_location.seller_product.product.main_product nearest_order=order_group.nearest_order %}
            {% with order_type=nearest_order.order_type %}
            <div class="row d-flex justify-content-between mb-3">
                <div class="col-auto px-1">
                    <img class="img-thumbnail img-container img-fluid border-0"
                        alt="Product image"
                        width="100"
                        height="85"
                        src="{% if main_product.images.first %}
                        {{ main_product.images.first.image.url }}
                        {% elif main_product.main_product_category.icon %}
                        {{ main_product.main_product_category.icon.url }}
                        {% else %}
                        {% static 'customer_dashboard/img/logo.png' %}
                        {% endif %}" />
                </div>
                <div class="col pt-2 px-1">
                    <h3 class="subtitle mb-1">{{ main_product.name }}</h3>
                    <p class="mb-1 order-descriptor">Nearest Service Date: <span class="fw-light">{{ nearest_order.end_date }}</span></p>
                    <p class="mb-1 order-descriptor">Nearest Order Type: <span class="fw-light">{{ order_type }}</span></p>
                    {% comment %} Uncomment when Bundled Qty is implemented {% endcomment %}
                    {% comment %} <p class="mb-1 order-descriptor">Qty: <span class="fw-light">1</span></p> {% endcomment %}
                    <p class="mb-1 order-descriptor">PO ID: <span class="fw-light">{{ order_group.project_id|default:"None" }}</span></p>
                </div>
            </div>
            <div class="row mb-3">
                <div class="d-flex align-items-center">
                    {% if type != "related" %}
                        <img class="cart-item-seller-logo img-container-sm me-2"
                        alt="Seller logo"
                        width="50"
                        height="50"
                        src="{% if order_group.seller_product_seller_location.seller_location.location_logo_image %}
                        {{ order_group.seller_product_seller_location.seller_location.location_logo_image.url }}
                        {% else %}
                        {% static 'customer_dashboard/img/defualt_logo.png' %}
                        {% endif %}" />
                        <p class="cart-item-seller-name mb-0 text-truncate">{{ order_group.seller_product_seller_location.seller_location.name }}</p>
                    {% endif %}
                </div>
            </div>
            <div class="row">
                {% if is_active %}
                    {% if order_type != 'ONE_TIME' %}
                    <div class="col px-2">
                        <a class="btn btn-danger btn-sm w-100" type="button" data-bs-target="#order-swap-modal" data-bs-toggle="modal" hx-trigger="click" hx-target="#order-swap-modal" hx-get="{% url 'customer_order_group_removal' order_group_id=order_group.id %}">Request Removal <span class="htmx-indicator" id="htmx-indicator-email"><img class="svg-loader" src="{% static 'supplier_dashboard/svg-loaders/bars-blue.svg' %}" /></span></a>
                    </div>
                        {% endif %}
                    {% if main_product.main_product_category.name == 'Roll Off Dumpsters' %}
                    <div class="col px-2">
                        <a class="btn btn-primary btn-sm w-100" type="button" data-bs-target="#order-swap-modal" data-bs-toggle="modal" hx-trigger="click" hx-target="#order-swap-modal" hx-get="{% url 'customer_order_group_swap' order_group_id=order_group.id %}">Request Swap <span class="htmx-indicator" id="htmx-indicator-email"><img class="svg-loader" src="{% static 'supplier_dashboard/svg-loaders/bars-blue.svg' %}" /></span></a>
                    </div>
                        {% endif %}
                    {% if type == "parent"%}
                    <div class="col px-2">
                        <button class="btn btn-primary btn-sm w-100 disabled" style="pointer-events: none;" type="button" title="This feature is not available yet." disabled>Add Linked Products <span class="htmx-indicator" id="htmx-indicator-email"><img class="svg-loader" src="{% static 'supplier_dashboard/svg-loaders/bars-blue.svg' %}" /></span></button>
                    </div>
                    {% elif type == "not_related" and order_group.parent_booking %}
                    <div class="col px-2">
                            <a href="{% url 'customer_order_group_detail' order_group.parent_booking_id %}" class="btn btn-light btn-sm w-100" title="Click to view parent booking details.">View Related Booking</a>
                        </div>
                    {% endif %}
                {% endif %}
            </div>
            {% endwith %}
            {% endwith %}
        </div>
      </div>
      {% if type == "related" %}
        <div class="position-absolute start-50 translate-middle bg-white border border-primary badge rounded-circle" style="top: -5px !important;">
            <span class="text-primary"><i class="far fa-link"></i></span>
        </div>
      {% endif %}
    </div>
    </div>
{% endwith %}
