{% include 'customer_dashboard/snippets/order_review_buttons.html' %}

{% block modals %}
  <div id="order-review-modal" hx-swap-oob="true" class="modal fade" role="dialog" tabindex="-1" hx-disabled-elt=".status-card, button, .form-control, .pagi-link">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        {% if formset %}
          <div class="modal-header">
            <h4 class="modal-title">Thanks for your feedback!</h4><button class="btn-close" type="button" aria-label="Close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <p class="text-muted">Please take some time to answer some additional questions:</p>
            <form method="post" action="{% url 'customer_order_review_form' %}">
              {% csrf_token %}
              {{ formset.management_form }}
              {% for form in formset %}
                <div class="form-group">
                  <!-- Include the hidden fields -->
                  <input type="hidden" name="order_id" value="{{ order.id }}" />
                  <input type="hidden" name="rating" value="{{ order.review.rating }}" />
                  {% for hidden in form.hidden_fields %}
                    {{ hidden }}
                  {% endfor %}
                  <!-- Include the visible fields -->
                  {% for field in form.visible_fields %}
                    <div class="mb-3">
                      <label for="{{ field.id_for_label }}" class="form-label mb-0">{{ field.label }}</label>
                      {% if field.help_text %}
                        <p id="{{ field.html_name }}Help" class="form-text text-muted mb-0">{{ field.help_text|safe }}</p>
                      {% endif %}
                      {% if field.widget_type == 'radioselect' %}
                        <div class="star-rating">
                          {% for radio in field|slice:'1:' reversed %}
                            {{ radio.tag }}
                            <label for="{{ radio.id_for_label }}" title="{{ radio.choice_label }}"><i class="fas fa-star"></i></label>
                          {% endfor %}
                        </div>
                      {% else %}
                        {{ field }}
                      {% endif %}
                      {% if field.errors %}
                        <small class="text-danger">{{ field.errors }}</small>
                      {% endif %}
                    </div>
                  {% endfor %}
                </div>
              {% endfor %}
              <div class="modal-footer">
                <button class="btn btn-primary" type="submit" id="card_submit">Submit</button>
              </div>
            </form>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
{% endblock %}
