{% load static %}
<!DOCTYPE html>
<html data-bs-theme="light" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>{% block title %}Dashboard - Downstream{% endblock %}</title>
    <!-- <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}"> -->
    <link rel="icon" type="image/png"
        href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAABbElEQVR4AWNhLC9lYGBkYPjPAAIEGYwsDH/+MpACgBr+YBP/DzYSq4bff5AtZWdmkhIQYmRk+PXnz/MPH/9CpVBs+A3naElIlri7X3z06N///1xs7KoS4uvOnd1+5fJ/JNuANiA0pNrYZC1YoCohAbTk1aeP3Vs3l3p6ff/2ff/NGyhO+s/wnxFsBiPQ5F8/Wf7+Yf73x0xONsLUpGrFiq6oqP1gS8DB9J/l/+9fjDBvzt2zuz8m9urjJ//+/1uwf3+Bp6cUL+/n79+Zf/3+ywj1JQvjL6iTgJwrd+/lzpghzs8PZP/4+k0UqPrzZxagWUjOhvsBFI4Jrq76ioqQcOFkYd1/+dK/Xz+Z//37BwyY/9CARgml+du3AT0Ddi7QtQwSQoITUtLqFy1ADhigHxARF+XkpC2vAPY+CHz+9rV8xvTXHz8ixwULI5INy3fuhDFhfgRHHHKco9hADADaQIKG/yAb/vzGTMp4AACCn6yMFV/i0QAAAABJRU5ErkJggg==">
    <link rel="stylesheet" href="{% static 'customer_dashboard/bootstrap/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
    <link rel="stylesheet" href="{% static 'customer_dashboard/css/Outfit.css' %}">
    <link rel="stylesheet" href="{% static 'customer_dashboard/css/bs-theme-overrides.css' %}">
    <!-- https://htmx.org/ -->
    <!-- NOTE: the onload is required for table partials https://htmx.org/examples/update-other-content/#oob -->
    <script src="https://unpkg.com/htmx.org@1.9.12"
        integrity="sha384-ujb1lZYygJmzgSwoxRggbCHcjc0rB2XoQrxeTUQyRjrOnlCoYta87iKBWq3EsdM2" crossorigin="anonymous"
        onload="htmx.config.useTemplateFragments = true;"></script>
    <!-- https://github.com/bigskysoftware/_hyperscript -->
    <script src="https://unpkg.com/hyperscript.org@0.9.12"></script>
    <!-- https://sweetalert2.github.io/ -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- This will export a global/window "BasisTheory" variable -->
    <script src="https://js.basistheory.com"></script>

    <!-- The callback parameter is required, so we use console.debug as a noop -->
    <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCKjnDJOCuoctPWiTQLdGMqR6MiXc_XKBE&callback=console.debug&libraries=maps,marker&v=beta">
    </script>

    <!-- Initialize Firebase Analytics -->
    <script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-analytics.js"></script>
    <script type="module">
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
        
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyAnA9tHeGsjRsXzzvInY9LGXexoUid_GEw",
            authDomain: "downstream-portal.firebaseapp.com",
            projectId: "downstream-portal",
            storageBucket: "downstream-portal.appspot.com",
            messagingSenderId: "862139088253",
            appId: "1:862139088253:web:34eb84f10cf1f2d7c32014",
            measurementId: "G-0XC2H310BR"
        };
        
        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const analytics = firebase.analytics();
    </script>
    <script type="text/javascript" src="https://downstreamsprints.atlassian.net/s/d41d8cd98f00b204e9800998ecf8427e-T/g2slup/b/9/c95134bc67d3a521bb3f4331beb9b804/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-US&collectorId=0ffcbda3"></script>

    {% block stylesheet %}{% endblock %}
    {% block javascript_head %}{% endblock %}
    {% if theme %}
        <style>
            /* OVERRIDE THEME HERE  */
            :root {
                --bs-primary: {{ theme.primary }};
            }
            .btn-primary {
                --bs-btn-hover-bg: {{ theme.primary_hover }};
                --bs-btn-hover-border-color: {{ theme.primary_hover }};
                --bs-btn-active-bg: {{ theme.primary_active }};
                --bs-btn-active-border-color: {{ theme.primary_active }};
            }
        </style>
    {% endif %}
    <style>
        /* Always set the map height explicitly to define the size of the div
        * element that contains the map. */
        gmp-map {
            height: 100%;
        }
        .accept-button {
            background: var(--bs-success);
        }
        .change-button {
            background: var(--bs-danger);
        }
        .complete-button {
            background: var(--bs-success);
        }
        @keyframes flash {

            0%,
            50%,
            100% {
                opacity: 1;
            }

            25%,
            75% {
                opacity: 0;
            }
        }

        .htmx-indicator {
            display: none;
        }

        .htmx-request .htmx-indicator {
            display: inline;
            /* animation: flash 1s infinite; */
        }

        .htmx-request.htmx-indicator {
            display: inline;
            /* animation: flash 2.0s infinite; */
        }

        #htmx-indicator-page {
            animation: flash 2.0s infinite;
        }

        .svg-loader {
            width: 20px;
            height: 20px;
        }

        .navbar-search-dropdown {
            width: 100%;
        }

        .navbar-search-dropdown .svg-loader {
            margin-left: 5px;
            font-size: x-small;
        }

        @media (min-width: 768px) {
            .navbar-search-dropdown {
                width: auto;
                min-width: 400px;
            }
        }

        .clickable-row {
            transition: background-color 0.3s ease;
        }
        .clickable-row:hover {
            cursor: pointer;
        }

        /* Autocomplete CSS */
        .my-dropdown {
            position: relative;
            display: inline-block;
        }
        
        .dropdown-content {
            display: block;
            position: absolute;
            background-color: #f1f1f1;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
            z-index: 1;
        }
        
        .dropdown-content div {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            cursor: pointer;
        }
        
        .dropdown-content div:hover {
            background-color: #ddd;
        }
        
        .dropdown:hover .dropdown-content {
            display: block;
        }
        .my-dropdown-item {
            cursor: pointer;
        }
        .autocomplete-active {
            background-color: DodgerBlue !important;
            color: #ffffff;
        }
        .header-sort-icon-up::after {
            content: "";
            display: inline-block;
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            margin-left: 5px;
        }
        .header-sort-icon-down::after {
            content: "";
            display: inline-block;
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            margin-left: 5px;
        }
        .header-sort-icon-up::after {
            border-bottom: 5px solid black; /* Arrow up */
        }
        .header-sort-icon-down::after {
            border-top: 5px solid black; /* Arrow down */
        }
        .form-select[multiple], .form-select[size]:not([size="1"]) {
            min-height: 180px;
        }

        .intercom-container {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            border: 1px solid transparent;
            transition: box-shadow 0.1s ease;
            margin: 8px 0;
            box-shadow: 0 0 4px transparent;
        }
        .intercom-container > img {
            border-radius: 8px 8px 0 0;
            width: 100%;
            height: auto;
        }
        .intercom-interblocks-link-content-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .intercom-interblocks-link-author {
            font-size: 12px;
            color: #6c757d;
            display: flex;
            justify-content: end;
            align-items: center;
            margin-top: 8px;
        }
        .intercom-interblocks-link-author-avatar {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .intercom-interblocks-link-author-summary {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .intercom-interblocks-link-author-avatar-image {
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }
        .intercom-interblocks-link-author-name {
            font-weight: 600;
        }
    </style>
</head>

<body id="page-top" hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>
    <div id="wrapper">
        {% block sidebar %}
        {% include 'customer_dashboard/sidebar.html' %}
        {% endblock %}
        <div class="d-flex flex-column" id="content-wrapper">
            <div id="content">
                {% block navbar %}
                {% include 'customer_dashboard/navbar.html' %}
                {% endblock %}
                <!-- MESSAGES -->
                {% include 'supplier_dashboard/snippets/djangomessages.html' %}
                <!-- MESSAGES -->
                <span class="htmx-indicator" style="margin-left:10px;" id="htmx-indicator-page">Loading...</span>
                <div id="page-content-wrappper">
                    {% block content %}
                    {% endblock %}
                </div>
            </div>
            {% include 'customer_dashboard/footer.html' %}
        {% comment %} </div><a class="border rounded d-inline scroll-to-top" href="#page-top"><i class="fas fa-angle-up"></i></a> {% endcomment %}
    </div>
    {% block modals %}
    {% endblock %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.min.js"></script>
    <script src="{% static 'customer_dashboard/js/bs-init.js' %}"></script>
    <script src="{% static 'customer_dashboard/js/theme.js' %}"></script>
    {% if request.user.intercom_id %}
        <script>
            // and not request.user.is_staff
            console.warn('USING Request.user!');
            function reloadIntercom() {
                if (window.Intercom) {
                    if (window.intercomSettings && window.intercomSettings.user_id != "{{ request.user.intercom_id|escapejs }}") {
                        window.Intercom('shutdown');
                        console.log(window.intercomSettings.user_id, "{{ request.user.intercom_id|escapejs }}");
                        console.log('2. Intercom user_id changed');
                    }
                }

                window.intercomSettings = {
                    api_base: "https://api-iam.intercom.io",
                    app_id: "d7p5ghkg",
                    name: "{{ request.user.full_name|escapejs }}", // Full name
                    user_id: "{{ request.user.intercom_id|escapejs }}", // a UUID for your user
                    email: "{{ request.user.email|escapejs }}", // the email for your user
                    created_at: "{{ request.user.date_joined|date:"U" }}" // Signup date as a Unix timestamp
                };
                // We pre-filled your app ID in the widget URL: 'https://widget.intercom.io/widget/d7p5ghkg'
                (function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/d7p5ghkg';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(document.readyState==='complete'){l();}else if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
            }
            reloadIntercom();
        </script>
    {% endif %}
    <script>
        function selectCustomerPopup(event) {
            Swal.fire({
                title: "Attention",
                text: "Please select a customer to begin a new order.",
                icon: "question",
                showCancelButton: true,
                confirmButtonText: "Yes",
                cancelButtonText: "Cancel",
            }).then((result) => {
                if (result.isConfirmed) {
                    // Open the Bootstrap dropdown dropdown-toggle
                    setTimeout(() => {
                        let dropdownToggle = document.querySelector(".dropdown-toggle");
                        if (dropdownToggle) {
                            dropdownToggle.click();
                        }
                    }, 100);
                }
            });
        }
        // Function to enable the submit button
        function enableAllSubmitButton() {
            document.querySelectorAll("button[type='submit']").forEach(function (button) {
                if (button.disabled) {
                    button.querySelector(".htmx-indicator").remove();
                    button.disabled = false;
                }
            });
        }

        // Add event listener for the pageshow event
        // Loop all submit buttons and if they are disabled, remove the htmx-indicator
        window.addEventListener('pageshow', function(event) {
            if (event.persisted) {
                enableAllSubmitButton();
            }
        });
        // Disable submit button after the form is submitted for all non htmx forms
        document.addEventListener("DOMContentLoaded", function () {
            // Select all forms that do not contain an attribute that starts with hx-
            document.querySelectorAll("form:not([hx-]").forEach(function (form) {
                // check if form has an attribute that starts with hx-
                // Loop all attributes of the form
                for (let i = 0; i < form.attributes.length; i++) {
                    // Get the attribute
                    let attribute = form.attributes[i];
                    // Check if the attribute name starts with hx-
                    if (attribute.name.startsWith("hx-")) {
                        return;
                    }
                }
                form.addEventListener("submit", function () {
                    console.log('submit non htmx form', form);
                    // Disable the submit button
                    setTimeout(() => {
                        let submitButton = form.querySelector('button[type="submit"]');
                        if (submitButton) {
                            // Create the span element
                            var span = document.createElement("span");
                            span.className = "htmx-indicator htmx-request ms-2";
            
                            // Create the img element
                            var img = document.createElement("img");
                            img.className = "svg-loader";
                            img.src = "{% static 'supplier_dashboard/svg-loaders/bars-blue.svg' %}";
                            // Append the img to the span
                            span.appendChild(img);
            
                            // Append the span to a target element in the DOM
                            // Replace 'targetElementId' with the actual ID of the target element
                            submitButton.appendChild(span);
                            submitButton.disabled = true;
                        }
                    }, 100);
                });
            });
        });
    </script>
    {% block javascript %}{% endblock %}
</body>

</html>